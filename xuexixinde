典型业务分解实例
本节包含以下内容：
业务日用量到达阈值控制业务带宽
基于用户类型的差异化带宽控制
业务日用量到达阈值控制业务带宽
需求描述
用户签约套餐200，且套餐200中包含HTTP业务。根据业务日使用量，下发对应的带宽策略控制，且超过阀值时短信通知用户，参见表1。

表1  策略控制需求
前提条件	业务日用量	策略控制
用户签约套餐200

套餐200中包含HTTP业务

<100M	业务上、下行带宽分别为1Mbps/1Mbps
>100M	业务上、下行带宽分别为64kbps/64kbps，且短信通知用户当前的业务使用量
需求分析
分析表1的需求，根据RCP策略控制机制，分解如下：

策略对象：定义用量累计对象（业务日用量）。

通知模板：提供通知消息的内容。

条件：针对HTTP业务，业务的日使用量。

动作参数：需要对HTTP受控业务进行业务决策；需要下发业务级用量监控，使PCEF能够上报用量，RCP能够累计用量；需要提供业务的QoS带宽及通知消息。

场景：该需求已明确是针对使用套餐200的用户，因此所有的策略规则都在用户使用套餐200时有效。场景入口条件为套餐200。

本例中几个条件的动作互不相同，因此条件确定无法合并，需要设置成独立的条件表达式。条件与动作的组合参见表2。

表2  条件与动作的组合
条件	动作
受控业务	配额状态	业务带宽（上/下行）	通知
HTTP业务	业务日用量<100M	1Mbps/1Mbps	无
业务日用量>100M	64kbps/64kbps	短信通知
数据配置分析
表2分析出条件与动作的组合共有2个，则需要配置如下参数。

基本数据配置-基本用量：定义用量累计对象（业务日用量）。

基本数据配置-通知：通知消息中需要能够提供当前的业务使用量，提醒用户将被降速。

条件：2个。HTTP业务条件及业务日用量条件。

动作参数：5个。动作的参数类型分别是：

“预下发业务参数集”：需要预下发HTTP受控业务对应的APPID。

“PCC规则参数集”：需要配置2个，分别下发默认带宽及降速带宽。

“业务用量监控参数集”：需要下发用量监控额度给PCEF，使PCEF能够及时上报用量。

“通知参数集”：需要提供通知发送的内容，通知发送方式等参数。

规则：5个。

每个规则分别关联上述动作参数集。

关联“预下发业务参数集”和“业务用量监控参数集”的2个规则不需要关联条件。

场景：1个。场景入口条件为套餐号200，该场景下需要触发的策略类型包括：

业务预下发控制策略

业务控制策略

业务级用量监控策略

通知策略

分解的业务配置关系如图1所示，详细说明参见表3。

图1  业务配置关系

表3  业务配置说明
名称	需求分解	说明
场景 Qos Based on Usage	
在用户上线或PCEF上报用量时被触发。此场景包含所有规则。

由RCP内部流程自动触发场景匹配。

规则 Rule_Pre	
此规则用于下发受控业务。

无关联条件。

规则 Rule_MK_Service	
此规则用于下发用量监控参数。

无关联条件。

规则 Rule_Service_Default	
此规则用于下发HTTP业务的默认QoS带宽。

关联HTTP业务条件。

规则 Rule_Service	
此规则用于当HTTP业务日用量超过阀值时下发降速带宽。

关联HTTP业务条件。

关联业务日用量条件。

该规则的优先级需高于默认带宽规则。

规则 Rule_Notice	
此规则用于控制用量条件匹配使发送通知。

关联业务日用量条件。

数据配置
前提条件

已完成各网元实体间（PCEF与RCP、SPR与RCP）的互通配置。

SPR上已经配置套餐200，且套餐下包含HTTP业务。

使用约束

无使用约束。

数据规划

套餐200优先级为1。

配置流程

本需求的所有配置在RCP网元侧完成。配置流程如图2所示。

图2  RCP侧业务配置流程图

配置步骤

配置套餐。

登录 RCP 本地维护终端-命令终端。

执行ADD PKGINFO，增加用户套餐。命令示例如下：

ADD PKGINFO:PKGID="200",PRIORITY=1;

配置套餐包含的业务。

登录 RCP 本地维护终端-命令终端。

执行ADD PKGSVC，增加套餐下的业务。命令示例如下：

ADD PKGSVC:ID=1,PKGID="200",SUBSID="1";

配置应用标识与签约业务的映射关系。

登录 RCP 本地维护终端-命令终端。

执行ADD APPSUBS，增加应用标识。命令示例如下：

ADD APPSUBS:APPID=1001,APPDESC="HTTP",SUBSID="1",SUBSDESC="HTTP";

登录 RCP Web GUI界面。

配置基本用量。配置导航为：策略管理→基本数据配置→基本用量。

基本用量的配置规划参见表4。

表4  基本用量配置
类别	参数	取值
基本用量	策略变量编号	1
策略变量名称	Usage_http_day_vol
用量层次	业务
用量周期	天
用量类型	流量
套餐标识	200
说明：已经在套餐基本配置中配置。

签约业务标识	1
说明：已经在套餐业务基本配置中配置。

配置条件。配置导航为：策略管理→策略元素配置→条件。

条件的配置规划参见表5。

表5  条件配置
类别	参数	取值
条件	名称	Cond_App
选择策略变量	其他
策略变量类别	IP-CAN会话信息类
策略变量	Gx应用标识
操作符	=
值类型	值
值	1001
说明：已经在应用标识配置中配置。

条件	名称	Cond_Usage
选择策略变量	用量
策略变量类别	总用量实际值
策略变量	Usage_http_day_vol
说明：已经在基本用量中配置。

操作符	>
值类型	值
值	104857600
配置通知。配置导航为：策略管理→基本数据配置→通知。

通知的配置规划参见表6。

表6  通知配置
类别	参数	取值
通知	通知名称	Notice_Usage
通知内容	“尊敬的用户，您好，你今日已经使用HTTP业务达到{Usage_http_day_vol.总用量实际值}(MByte)。如有需要请充值。”
说明：通知内容中包含业务日用量的动态信息。

配置动作参数。配置导航为：策略管理→策略元素配置→动作参数。

动作参数的配置规划参见表7。

表7  动作参数配置
类别	参数	取值
动作参数	名称	Action_Pre
参数类型	预下发业务参数集
应用标识	1001
动作参数	名称	Action_MK_Servicer
参数类型	业务用量监控参数集
流量门限控制方式	固定值
总流量门限(Kbps)	10240
动作参数	名称	Action_Service_Default
参数类型	PCC规则参数集
业务规则类型	动态规则
规则名	1001_default
应用标识	1001
请求的上行流带宽(bps)	1048576
请求的下行流带宽(bps)	1048576
Monitoring Key	1001
动作参数	名称	Action_Service
参数类型	PCC规则参数集
业务规则类型	动态规则
规则名	1001_reduce
应用标识	1001
请求的上行流带宽(bps)	65536
请求的下行流带宽(bps)	65536
Monitoring Key	1001
动作参数	名称	Action_Notice
参数类型	通知参数集
全局通知编号	1
需要保证工程内编号唯一。

通知类型	SMS/EMAIL
表示发送短信或邮件通知。具体通知方式由通知内容项确定。

私人短信通知内容	Notice_Usage
表示只向用户发送短信通知。关联的通知内容已经在通知中配置。

配置场景和规则。配置导航为：策略管理→策略元素配置→场景。

场景的配置规划参见表8。

表8  场景配置
类别	参数	取值
场景	名称	Qos Based on Usage
入口	入口类型	用户信息类
已选入口	用户套餐
取值	200
策略类型	预下发控制策略	关联规则Rule_Pre
业务级用量监控策略	关联规则Rule_MK_Service
业务控制策略	
关联规则Rule_Service_Default

关联规则Rule_Service

通知策略	关联规则Rule_Notice
规则的配置规划参见表9。

表9  规则配置
类别	参数	取值
规则	名称	Rule_Pre
优先级	1
动作类型	参数填充
条件表达式	无
动作参数名称	Action_Pre
说明：已在动作参数中配置。

规则	名称	Rule_MK_Service
优先级	1
动作类型	参数填充
条件表达式	无
动作参数名称	Action_MK_Service
说明：已在动作参数中配置。

规则	名称	Rule_Service_Default
优先级	1
动作类型	参数填充
条件表达式	Cond_App
说明：已在条件中配置。

动作参数名称	Action_Service_Default
说明：已在动作参数中配置。

规则	名称	Rule_Service
优先级	10
动作类型	参数填充
条件表达式	Cond_App&Cond_Usage
说明：已在条件中配置。

动作参数名称	Action_Service
说明：已在动作参数中配置。

规则	名称	Rule_Notice
优先级	1
动作类型	立即发送
条件表达式	Cond_Usage
说明：已在条件中配置。

动作参数名称	Action_Notice
说明：已在动作参数中配置。

提交策略配置。提交路径：策略管理→提交。提交的目的是使策略数据能够生效。

基于用户类型的差异化带宽控制
需求描述
针对所有使用套餐100的用户，需要根据用户的签约类型（分为：金牌用户/银牌用户/铜牌用户），下发对应的带宽策略控制，参见表10。

表10  带宽控制需求
前提条件	用户类型	QoS参数
使用套餐100的用户	金牌用户	上、下行带宽分别为：6Mbps/6Mbps，QCI=6
银牌用户	上、下行带宽分别为：4Mbps/4Mbps，QCI=8
铜牌用户	上、下行带宽分别为：2Mbps/2Mbps，QCI=9
需求分析
分析表10的需求，根据RCP策略控制机制，分解如下：

条件：用户类型（金牌用户/银牌用户/铜牌用户）。

动作参数：提供默认承载的QoS带宽和QCI参数。

场景：该需求已明确是针对使用套餐100的用户，因此所有的策略规则都在用户使用套餐100时有效。场景入口条件为套餐100。

本例中几个条件的动作互不相同，因此条件确定无法合并，需要设置成独立的条件表达式。条件与动作的组合参见表11。

表11  条件与动作的组合
条件	动作
用户类型	用户带宽（上/下行）	QCI参数
金牌用户	6Mbps/6Mbps	6
银牌用户	4Mbps/4Mbps	8
铜牌用户	2Mbps/2Mbps	9
数据配置分析
表11分析出条件与动作的组合共有3个，则需要配置如下参数。

条件：3个。每个条件中的策略对象都是用户类型，运算符都是“等于”，参考值分别为“金牌用户”、“银牌用户”、“铜牌用户”。3个条件之间无交集，且合集可以覆盖该需求场景。

动作参数：3个。每个动作的参数类型都是“承载参数集”。每个动作中都包含“最大请求上行带宽”、“最大请求下行带宽”、“保障上行带宽”、“保障下行带宽”和“QCI”参数。

规则：3个。每个规则都包含一个条件和一个动作。由于3个规则之间无冲突，因此不需要特殊调整规则的优先级，优先级相同即可。

场景：1个。场景入口条件为套餐号100，该场景下可进行承载控制策略，包含上述3个规则。

分解的业务配置关系如图3所示，详细说明参见表12。

图3  业务配置关系

表12  业务配置说明
名称	需求分解	说明
场景 Qos Based on User Type	
在用户上线或SPR主动更新用户签约时被触发。此场景包含所有规则。

由RCP内部流程自动触发场景匹配。

规则 Rule_Gold	
此规则用于控制用户类型为“金牌”的QoS带宽。

使用用户类型作为控制条件。条件的策略对象在“其他”分类下选择“用户信息类”的“用户类型”。

规则 Rule_Silver	
此规则用于控制用户类型为“银牌”的QoS带宽。

规则 Rule_Bronze	
此规则用于控制用户类型为“铜牌”的QoS带宽。

数据配置
前提条件

已完成各网元实体间（PCEF与RCP、SPR与RCP）的互通配置。

SPR上已经配置套餐100。

用户类型只划分为3类，分别为：金牌、银牌、铜牌。枚举值分别为：1、2、3。

使用约束

无使用约束。

数据规划

套餐100优先级为1。

配置流程

本需求的所有配置在RCP网元侧完成。配置流程如图4所示。

图4  RCP侧业务配置流程图

配置步骤

配置套餐。

登录RCP本地维护终端-命令终端。

执行ADD PKGINFO，增加用户套餐100。命令示例如下：

ADD PKGINFO:PKGID="100",PRIORITY=1;

登录RCP Web GUI界面。

配置条件。配置导航为：策略管理→策略元素配置→条件。

条件的配置规划参见表13。

表13  条件配置
类别	参数	取值
条件	名称	Cond_Gold
选择策略变量	其他
策略变量类别	用户信息类
策略变量	用户类型
操作符	=
值类型	值
值	301
说明：与SPR约定用户类型为301时表示金牌用户。

条件	名称	Cond_Silver
选择策略变量	其他
策略变量类别	用户信息类
策略变量	用户类型
操作符	=
值类型	值
值	302
说明：与SPR约定用户类型为302时表示银牌用户。

条件	名称	Cond_Bronze
选择策略变量	其他
策略变量类别	用户信息类
策略变量	用户类型
操作符	=
值类型	值
值	303
说明：与SPR约定用户类型为303时表示铜牌用户。

配置动作参数。配置导航为：策略管理->策略元素配置->动作参数。

动作参数的配置规划参见表14。

表14  动作参数配置
类别	参数	取值
动作参数	名称	Action_Gold
参数类型	承载参数集
最大请求上行带宽(bps)	6144000
最大请求上行带宽(bps)	6144000
保障上行带宽(bps)	6144000
保障下行带宽(bps)	6144000
QCI	6
动作参数	名称	Action_Silver
参数类型	承载参数集
最大请求上行带宽(bps)	4096000
最大请求上行带宽(bps)	4096000
保障上行带宽(bps)	4096000
保障下行带宽(bps)	4096000
QCI	8
动作参数	名称	Action_Bronze
参数类型	承载参数集
最大请求上行带宽(bps)	2048000
最大请求上行带宽(bps)	2048000
保障上行带宽(bps)	2048000
保障下行带宽(bps)	2048000
QCI	9
配置场景和规则。配置导航为：策略管理→策略元素配置→场景。

场景的配置规划参见表15。

表15  场景配置
类别	参数	取值
场景	名称	Qos Based on User Type
入口	入口类型	用户信息类
已选入口	用户套餐
取值	100
策略类型	承载控制策略	
关联规则Rule_Gold

关联规则Rule_Silver

关联规则Rule_Bronze

规则的配置规划参见表16。

表16  规则配置
类别	参数	取值
规则	名称	Rule_Gold
优先级	1
动作类型	参数填充
条件表达式	Cond_Gold
说明：已在条件中配置。

动作参数名称	Action_Gold
说明：已在动作参数中配置。

规则	名称	Rule_Silver
优先级	1
动作类型	参数填充
条件表达式	Cond_Silver
说明：已在条件中配置。

动作参数名称	Action_Silver
说明：已在动作参数中配置。

规则	名称	Rule_Bronze
优先级	1
动作类型	参数填充
条件表达式	Cond_Bronze
说明：已在条件中配置。

动作参数名称	Action_Bronze
说明：已在动作参数中配置。

提交策略配置。提交路径：策略管理→提交。提交的目的是使策略数据能够生效。
