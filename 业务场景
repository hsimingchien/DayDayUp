总体原则
概述
本节介绍从业务策略需求拆解分析出业务策略配置方案时应遵守的基本原则。

条件
条件一般由策略对象、参考值及运算符组成。在RCP中可以配置：用量条件、金额条件、时间条件、用户签约信息类条件、接入信息类条件、IP-CAN会话信息类条件、IP-CAN承载信息类条件、组信息类条件、UBAS接口类条件、系统类条件、流信息类条件、AF信息类条件、自定义策略变量类条件、表达式策略变量类条件、映射策略变量类条件。在GUI中通过条件完成配置。

将用户发起的请求中携带的信息或RCP感知到的用户相关信息与RCP上配置的相应策略规则中相应条件的参考值进行比较，以此确定条件的匹配结果。

若干个条件可以通过逻辑符号组成条件表达式。条件和条件表达式的结果都只能是真或假。每个策略规则关联一个条件表达式。只有当条件表达式的结果为真时，策略规则才会被RCP下发给相关网元。

条件表达式下所有条件之间可以配置的关系，按照执行优先级由高至低的顺序为：“（）”、“非”、“与”、“或”。

使用“（）”可以优先对其中所包含的条件组合进行判断。

当关系设置为“非”时，需要先对条件结果取反，再确定条件表达式的结果。

当关系设置为“与”时，只有条件表达式下的所有条件结果都为真，该条件表达式结果才为真；

当关系设置为“或”时，只要条件表达式下的任意一个条件结果为真，该条件表达式结果就为真；

当条件表达式中没有条件时，表示条件表达式结果恒为真。

对一个具体的业务策略需求，其中每个策略规则的匹配时机都可以用一个条件表达式来表示。匹配时机中的每个时机控制点都可以用一个条件来表示。

例如，业务策略要求为：每天20:00~22:00，当用户使用4G从区域A上线时，下发策略规则1。进行业务分解后，条件1为每天20:00~22:00，条件2为用户使用4G接入，条件3为用户从区域A接入。条件表达式为条件1&条件2&条件3。

一个场景下所有策略规则的条件表达式定义的范围之间尽量没有交集。如果有交集，那么条件表达式结果为真时，高优先级的策略规则会被触发。

例如，策略规则1的优先级为2，条件表达式1为“用户在8:00~10：00上线”；策略规则2的优先级为1，条件表达式2为“用户在6:00~20：00上线”。则某用户9:00上线时，由于策略规则1的优先级高，因此会触发策略规则1。

所有条件表达式的并集要覆盖所有场景，否则会导致没有被覆盖的用户无法获取正确的规则。

如果几个条件的动作一样，则可以考虑将这几个条件合并成关系为“或”的条件表达式。确定无法合并的，设置成独立的条件表达式。

动作
动作，即在策略规则的条件表达式结果为真时，该策略规则的可执行的操作。

动作中可能包含QoS参数、计费参数、用量监控参数、通知参数和重定向参数等。

QoS参数：包含带宽决策方式、具体的带宽参数等。不同类型的参数集中的QoS参数指示接口中不同层次上的带宽，一般是会话层带宽、承载层带宽、业务层带宽。

计费参数：包含计费方式、计费地址等参数。

用量监控参数：包含门限控制方式、用量监控门限参数等。用量监控参数用于指示PCEF在用量达到监控门限值时向RCP上报用量，使RCP能够作出新的策略下发给PCEF执行。

通知参数：使用短信、邮件或SOAP消息将用户的使用状态通知给用户。使用时需要单独配置通知内容模板。在GUI中通过通知进行配置。

重定向参数：分为一次重定向和永久重定向两种。当用户使用量达到某个阈值时，将用户访问页面重定向到某个地址。

RCP把上述参数划分为以下的动作参数类型，在GUI中通过动作参数完成配置。

套餐动态属性参数集：此类动作参数可以指定套餐的优先级或将指定套餐置为无效状态，即动态调整套餐的优先级属性。在RCP为用户选择套餐时使用。

承载参数集：此类动作参数用于指定IP-CAN承载层的QoS参数。

会话参数集：此类动作参数用于指定会话层的QoS参数、计费参数。

会话用量监控参数集：此类动作参数用于指定会话层的用量监控参数。

通知参数集：此类动作参数用于指定通知类型、通知内容模板、通知防骚扰参数等。通知类型即通知的具体发送形式，包括短信、邮件或SOAP消息。通知内容模板确定了通知内容。通知防骚扰参数可控制通知发送的频率及次数。

预下发业务参数集：此类动作参数可以指定需要进行决策的受控业务列表。可根据用户签约进行预下发或直接指定受控业务ID。

PCC规则参数集：分为预定义规则和动态规则。此类动作参数用于指定Gx接口上业务层的QoS参数、重定向参数、计费参数等。

QoS规则参数集：分为预定义规则和动态规则。此类动作参数用于指定Gxx接口上业务层的QoS参数等。

ADC规则参数集：分为预定义规则和动态规则。此类动作参数用于指定Sd接口上业务层的QoS参数、重定向参数、计费参数等。

PCC预定义规则组参数集：此类动作参数用于指定Gx接口上业务层的预定义规则组。

QoS预定义规则组参数集：此类动作参数用于指定Gxx接口上业务层的预定义规则组。

ADC预定义规则组参数集：此类动作参数用于指定Sd接口上业务层的预定义规则组。

业务用量监控参数集：此类动作参数用于指定业务层的用量监控参数。

从上述动作参数类型中可以看到，PCC规则参数集、QoS规则参数集、ADC规则参数集非常类似。在实际组网中，需要根据邻接网元的类型进行区分。与RCP邻接的PCEF/BBERF/TDF网元需要分别配置PCC规则参数集、QoS规则参数集、ADC规则参数集。

规则
一个策略规则中包含一个条件表达式和一个动作参数集，并且策略规则具有优先级属性。策略规则表示当条件表达式为真时，需要执行其动作参数集中指定的动作参数。

RCP把规则与场景的配置融合。在为场景确定策略类型后，添加此种策略类型下的规则即可。在GUI中通过场景完成配置。

策略场景与规则关联。当一个或几个策略场景同时发生时，将这些场景引用的同一策略类型下的规则按照优先级由高至低的顺序进行排序，按照排序结果依次根据条件表达式结果匹配规则。高优先级的规则匹配后，将规则的动作执行。后续低优先级的规则不再进行匹配。但通知类型的规则除外，策略场景下所有通知类型的规则不区分优先级，一旦匹配都将被执行。

一个通知参数集只能被唯一一个通知策略类型的规则使用。

一个业务控制策略类型的规则可以关联PCC规则参数集、QoS规则参数集、ADC规则参数集中的一个或多个，并且规则参数集类型必须互不相同。

如果一个场景下同种策略类型的规则有多个，那么需要根据具体应用设置优先级。优先级数值越大，则规则的优先级越高。

例如，业务策略要求为：当用户日流量>100M时，将用户带宽降为512Kbps；当用户日流量>200M时，将用户带宽降为128Kbps。进行业务分解，条件1为用户日流量>100M，条件2为用户日流量>200M。会话参数集1中配置带宽为512Kbps，会话参数集2中配置带宽为128Kbps。配置策略规则1，条件表达式1为条件1，触发会话参数集1；策略规则2，条件表达式2为条件2，触发会话参数集2。考虑到当条件2为真时，条件1也为真。因此，策略规则2的优先级应该高于策略规则1。

场景
场景由入口条件和策略规则组成。一个场景最多可使用三个入口条件，可以关联不同策略类型的规则。使用场景的入口条件，可以确定该场景关联的规则的使用范围。

根据业务策略需求，可分解出一个或多个场景。每个场景需要分析入口条件及该场景关联的策略类型。

例如，业务策略要求为：对于金牌用户做如下策略控制：当用户使用HTTP业务时，初始带宽为512kbps，如果HTTP业务的使用流量>200M，则降低带宽为128kbps并且发短信通知用户当前的使用量。业务分解过程如下：

确定场景的入口条件。进行业务分析可以了解到：所有的策略控制都是针对金牌用户的HTTP业务。因此，金牌用户是一个入口条件，HTTP业务是第二个入口条件。

确定该场景需要做哪些类型的策略。假定用户已经先签约HTTP业务且可以使用。要对HTTP业务做决策，需要配置预下发业务策略，使RCP感知到该业务发生。其次，基于HTTP业务的使用量进行控制，需要配置业务策略和业务用量监控策略。业务用量监控策略用于PCEF上报用量，在累计用量达到200M时能够根据业务策略触发新的策略动作。

检查该场景下每个策略类型的规则配置要求。业务策略中要求HTTP业务的使用流量>200M后，降低带宽，该带宽值与初始带宽不同。那么，在业务策略中需要配置2条业务规则。业务规则1，无条件执行，带宽为512kbps；业务规则2，条件表达式为：HTTP业务的使用流量>200M，带宽为128kbps。并且业务规则2的优先级高于业务规则1。

配置确定后需要按照业务策略要求检查是否满足策略要求。HTTP业务的使用量从0M开始，从高优先级的规则开始匹配。不满足业务规则2，因此使用量不足200M时，匹配业务规则1，RCP下发带宽512kbps。随着使用量的逐渐增加，达到200M后，再次进行策略匹配。依然从高优先级规则开始。此时可以匹配业务规则2，RCP下发带宽128kbps。满足业务策略要求，则配置完成。
